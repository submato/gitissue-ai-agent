# Issue 状态管理说明

## 🎯 工作流程

本 AI Agent 使用标签来管理 issue 的处理状态，避免重复处理。

### 标签状态说明

| 标签 | 含义 | Agent 行为 |
|------|------|-----------|
| `bot` | 触发标签 | 开始处理 |
| `analyzing` | 正在分析 | 跳过（避免重复） |
| `needs-info` | 等待用户补充信息 | **跳过，直到用户移除此标签** |
| `in-progress` | AI 确认可以处理 | 跳过（正在实施中） |
| `cannot-fix` | AI 无法自动处理 | 跳过（需要人工） |

### 核心规则

**🔑 关键点：用户回复后需要手动移除 `needs-info` 标签**

Agent 只会处理：
- ✅ 有 `bot` 标签
- ✅ 且**没有**任何状态标签（`needs-info`, `in-progress`, `cannot-fix`, `analyzing`）的 issues

---

## 📝 完整工作流示例

### 场景 1：AI 需要更多信息

1. **用户创建 issue** 并打上 `bot` 标签
   ```
   标签：[bot]
   ```

2. **AI Agent 处理**
   - 添加 `analyzing` 标签
   - 分析后发现信息不足
   - 发布评论询问问题
   - 移除 `analyzing`，添加 `needs-info` 标签
   ```
   标签：[bot, needs-info]
   评论：📌 After you reply: Please remove the `needs-info` label
   ```

3. **用户回复补充信息**
   ```
   用户评论：这是你要的信息...
   标签：[bot, needs-info]  ← 注意：标签还在
   ```

4. **❌ Agent 不会处理**
   - 因为还有 `needs-info` 标签
   - Agent 会跳过这个 issue

5. **✅ 用户手动移除 `needs-info` 标签**
   ```
   标签：[bot]  ← 只剩 bot 标签
   ```

6. **✅ Agent 重新处理**
   - 检测到没有状态标签
   - 读取用户的新评论
   - 重新分析
   - 根据新信息采取行动

---

### 场景 2：AI 可以处理

1. **用户创建 issue** 并打上 `bot` 标签
   ```
   标签：[bot]
   ```

2. **AI Agent 处理**
   - 分析后确认可以处理
   - 发布处理计划
   - 添加 `in-progress` 标签
   ```
   标签：[bot, in-progress]
   ```

3. **后续处理**
   - Agent 不会重复处理（有 `in-progress` 标签）
   - 等待实际修复完成后，可以关闭 issue 或移除标签

---

### 场景 3：AI 无法处理

1. **AI Agent 处理**
   - 分析后发现太复杂
   - 发布说明评论
   - 添加 `cannot-fix` 标签
   ```
   标签：[bot, cannot-fix]
   ```

2. **后续处理**
   - Agent 不会再次处理
   - 需要人工介入

---

## 🔧 如何重新触发处理

### 方法 1：移除状态标签（推荐）

适用于补充信息后重新分析：

```
1. 用户回复补充信息
2. 手动移除 needs-info 标签
3. Agent 在下次扫描时会重新处理
```

### 方法 2：完全重置

如果想让 Agent 完全重新分析：

```
1. 移除所有状态标签（needs-info, in-progress, cannot-fix, analyzing）
2. 保留 bot 标签
3. Agent 会当作新 issue 处理
```

---

## 💡 为什么需要手动移除标签？

### 原因

1. **避免重复处理**
   - 如果用户回复了但还在思考要不要补充更多信息
   - Agent 不应该立即处理，应该等用户确认完整

2. **用户控制节奏**
   - 用户可能需要分多次回复
   - 用户决定什么时候"信息已经完整，可以处理了"

3. **状态明确**
   - 标签清楚表明 issue 当前状态
   - 避免状态混乱

### 实际场景

**不好的方式（自动触发）：**
```
10:00 - AI: 请问你用的什么版本？
10:01 - 用户: Python 3.8
10:01 - AI: [立即处理] ← 但用户可能还想补充更多信息
10:02 - 用户: 还有，我用的是 Linux...  ← AI 已经处理完了
```

**好的方式（手动触发）：**
```
10:00 - AI: 请问你用的什么版本？
10:01 - 用户: Python 3.8
10:02 - 用户: 还有，我用的是 Linux，Ubuntu 22.04
10:03 - 用户: [移除 needs-info 标签] ← 明确表示"信息完整了"
10:05 - AI: [开始处理，看到了所有信息]
```

---

## 📊 状态转换图

```
[用户创建 issue + bot 标签]
    ↓
[AI 开始分析 + analyzing 标签]
    ↓
┌─────────────┬─────────────┬─────────────┐
│ need_info   │ can_handle  │ skip        │
│ + needs-info│ + in-progress│ + cannot-fix│
└──────┬──────┴─────────────┴─────────────┘
       │
       ↓
[等待用户补充]
       ↓
[用户回复评论] ← Agent 不处理（有 needs-info 标签）
       ↓
[用户移除 needs-info 标签] ← 触发重新处理
       ↓
[AI 重新分析]
```

---

## 🎮 GitHub UI 操作

### 移除标签步骤

1. 打开 issue 页面
2. 右侧 "Labels" 部分
3. 点击 `needs-info` 标签旁的 ❌
4. 标签立即移除
5. 等待 Agent 下次扫描（通常 3-5 分钟）

### 示例截图说明

```
┌────────────────────────────────────┐
│ Issue Title                        │
│                                    │
│ 描述内容...                         │
│                                    │
│ 💬 Comment                         │
│ 👋 Hi! I need more info...        │
│ 📌 After you reply: Please remove │
│    the needs-info label            │
└────────────────────────────────────┘
                                 ┌──────────────┐
                                 │ Labels       │
                                 │ ┌──────────┐ │
                                 │ │ bot      │ │
                                 │ │ needs-   │ │
                                 │ │ info  ❌ │ │ ← 点击这里移除
                                 │ └──────────┘ │
                                 └──────────────┘
```

---

## ❓ 常见问题

**Q: 我回复了为什么 Agent 不处理？**

A: 检查 issue 是否还有 `needs-info` 标签。需要手动移除才会重新处理。

**Q: 能不能用户回复后自动移除标签？**

A: 技术上可以，但不推荐。用户可能需要分多次回复，应该由用户决定什么时候"信息完整"。

**Q: 标签被误加了怎么办？**

A: 直接在 GitHub UI 移除错误的标签即可。

**Q: 能不能用评论触发而不是标签？**

A: 可以修改代码实现，但标签方式更直观，状态更清晰。

**Q: 为什么不直接监听评论事件？**

A: 监听评论会导致用户每次回复都触发，可能用户还在补充信息中。标签方式让用户控制节奏。

---

## 🚀 最佳实践

1. **创建 issue 时**
   - 尽量提供完整信息
   - 打上 `bot` 标签

2. **收到 AI 询问时**
   - 阅读完所有问题
   - 一次性回复所有信息
   - 确认信息完整后再移除标签

3. **补充信息后**
   - 确认不再需要补充
   - 移除 `needs-info` 标签
   - 等待 AI 重新分析

4. **如果 AI 错误**
   - 直接在评论中说明
   - 移除 `in-progress` 或其他标签
   - Agent 会重新分析

---

## 📖 相关文档

- [GitHub vs GitLab 对比](GITHUB_VS_GITLAB.md)
- [多项目配置](MULTI_PROJECT_CONFIG.md)
- [服务器部署](SERVER_SETUP.md)
